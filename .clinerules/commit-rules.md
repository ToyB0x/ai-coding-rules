# コミットルール

更新日: 2025/03/22
確認日: 2025/03/22

## 目的

このドキュメントは、ClineなどのLLMがGitリポジトリでコード変更を行った後、適切なタイミングでコミットを提案し、質の高いコミットメッセージを作成するためのルールとガイドラインを定義します。コミット履歴は開発の文脈や意思決定の過程を記録する重要な情報源であり、人間とAIの協働を円滑にするために重要です。

## コミット提案のタイミング

Clineは以下のタイミングで積極的にコミットを提案すべきです：

- タスクや作業の完了時に毎回積極的にコミットを提案すること
- 複数のファイルの変更を伴う場合は特に重要
- 論理的なまとまりのある変更ごとに提案すること（複数の無関係な変更を一つのコミットにまとめないこと）
- ユーザーが明示的にコミットを求めなくても、作業完了時には自発的に提案すること

## コミットメッセージの構造

コミットメッセージは以下の構造に従うこと：

```
<種類>: <簡潔な要約>

<詳細な説明>

<変更されたファイル一覧>

<プロンプト履歴>
```

### 種類（Type）の例

- `feat`: 新機能の追加
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響を与えない変更（空白、フォーマット、セミコロンの欠落など）
- `refactor`: バグ修正でも機能追加でもないコード変更
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやドキュメント生成などの変更

## コミットメッセージに含めるべき情報

コミットメッセージには以下の情報を含めてください：

- 変更内容の簡潔かつ明確な要約
- 変更の理由や背景（必要に応じて）
- 変更されたファイルの一覧
- 関連するIssue番号やチケット番号（該当する場合）
- **プロンプト履歴**（重要：作業内容の追跡と判断根拠の記録として必須）

## プロンプト履歴の記録ルール

プロンプト履歴は以下の形式で記録し、必ずコミットメッセージに含めること：

```
Prompt History:
Q: ユーザーからの質問や指示1
A: AIからの回答や実行内容の要約1

Q: ユーザーからの質問や指示2
A: AIからの回答や実行内容の要約2
```

### プロンプト履歴に記録する情報

1. **ユーザーの質問・指示**
   - 元の質問や指示をそのまま記録
   - 長文の場合は核となる部分を抽出して記録

2. **AIの回答・実行内容**
   - 実行したアクションの要約
   - 重要な決定事項
   - 生成したコードやファイルの概要

### 記録時の注意点

- 簡潔さと具体性のバランスを保つ
- 重要な意思決定の理由を含める
- 変更したファイルのパスを明記する
- 関連する一連の対話はまとめて記録する

## ユーザーとのインタラクション

コミット提案時には以下の点に注意してください：

- コミット提案時には、メッセージ案を提示してユーザーの承認を得ること
- 提案を修正できるよう、コミットメッセージを編集可能な形で提示すること
- コミットコマンド（git commit -m "..."）を実行する準備ができていることを伝えること

## コミットメッセージの例

### 例1：新機能追加の場合

```
feat: ユーザー認証機能の実装

- JWTを使用したユーザー認証システムを実装
- ログイン、ログアウト、トークン更新のエンドポイントを追加
- 認証ミドルウェアを実装して保護されたルートを作成

変更ファイル：
- src/auth/authController.js
- src/auth/authMiddleware.js
- src/routes/authRoutes.js
- src/models/User.js

Prompt History:
Q: ユーザー認証システムを実装してください。JWTを使用してください。
A: JWTベースの認証システムを実装。authController.jsでトークン生成・検証、authMiddleware.jsで認証ミドルウェア、authRoutes.jsでルート定義、User.jsでモデル実装。

Q: 認証トークンの有効期限設定はどうすればいいですか？
A: authController.jsにて、アクセストークンに1時間、リフレッシュトークンに7日間の有効期限を設定。リフレッシュトークンエンドポイントも実装。
```

### 例2：バグ修正の場合

```
fix: ユーザープロファイル更新時のバリデーションエラーを修正

- 空の入力フィールドを適切に処理するようにバリデーションロジックを修正
- エラーメッセージをより具体的にして、ユーザーが問題を特定しやすくした

変更ファイル：
- src/validators/userValidator.js
- src/controllers/userController.js

Prompt History:
Q: プロファイル更新時に空の入力があるとエラーになる問題を修正してください
A: userValidator.jsでバリデーションロジックを修正し、空入力を許容するように変更。また、エラーメッセージをより具体的に改善。

Q: テストケースも更新してください
A: 空入力を許容するケースのテストを追加。境界値テストも実装。
```

### 例3：ドキュメント更新の場合

```
docs: READMEとAPIドキュメントの更新

- インストール手順を明確化
- 新しいエンドポイントのドキュメントを追加
- 設定オプションの説明を更新

変更ファイル：
- README.md
- docs/api.md

Prompt History:
Q: APIドキュメントを更新して、新しいエンドポイントの情報を追加してください
A: docs/api.mdを更新し、新しいエンドポイントの詳細（パラメータ、レスポンス形式、エラーコード）を追加。

Q: READMEも更新してインストール手順を明確にしてください
A: README.mdのインストールセクションを更新。依存関係、環境変数設定、オプション設定についての説明を追加。
```

## まとめ

質の高いコミットメッセージは、コードの変更履歴を理解しやすくするだけでなく、AI支援開発における人間とAIのコミュニケーションの透明性を高めます。プロンプト履歴を含めることで、どのような指示や質問に基づいて変更が行われたのかを明確に記録し、将来の開発者（人間とAI両方）が変更の意図を理解しやすくなります。

## Changelog

### 2025/03/22
- [追加] 初版commit-rules.mdファイル作成
- [追加] コミット提案のタイミング、メッセージの構造、含めるべき情報などの詳細を記載
- [追加] プロンプト履歴をコミットメッセージに含めることの重要性と具体的な記録方法を説明
- [追加] コミットメッセージの具体的な例を追加